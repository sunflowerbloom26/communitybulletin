<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community Bulletin Board</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Nunito', sans-serif; }
    .category-card { transition: all 0.3s ease; }
    .category-card:hover { transform: translateY(-4px); }
    .ad-card { 
      animation: fadeIn 0.4s ease-out;
      transition: all 0.2s ease;
    }
    .ad-card:hover { transform: scale(1.02); }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pin {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .modal-overlay {
      animation: fadeOverlay 0.2s ease-out;
    }
    @keyframes fadeOverlay {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full overflow-auto" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);"><!-- Header -->
   <header class="bg-amber-900/90 backdrop-blur-sm shadow-lg sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-4">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
       <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center shadow-md"><span class="text-2xl">ğŸ“Œ</span>
       </div>
       <div>
        <h1 id="board-title" class="text-2xl font-extrabold text-amber-50">Community Bulletin Board</h1>
        <p id="board-subtitle" class="text-amber-200 text-sm">Your local marketplace for ads &amp; services</p>
       </div>
      </div><button id="post-ad-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2.5 rounded-full font-bold shadow-lg transition-all flex items-center gap-2"> <span class="text-lg">+</span> Post Ad </button>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="max-w-6xl mx-auto px-4 py-6"><!-- Category Filter -->
    <div id="categories-section" class="mb-8">
     <h2 class="text-amber-100 font-bold text-lg mb-4">Browse by Category</h2>
     <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3"><button data-category="all" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸ </span> <span class="text-xs font-bold text-amber-900 text-center">All Ads</span> </button> <button data-category="rentals" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸ¡</span> <span class="text-xs font-bold text-amber-900 text-center">Rentals</span> </button> <button data-category="food" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸœ</span> <span class="text-xs font-bold text-amber-900 text-center">Food Stalls</span> </button> <button data-category="jobs" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸ’¼</span> <span class="text-xs font-bold text-amber-900 text-center">Jobs &amp; Services</span> </button> <button data-category="transport" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸš—</span> <span class="text-xs font-bold text-amber-900 text-center">Transport</span> </button> <button data-category="others" class="category-btn category-card bg-amber-50 hover:bg-amber-100 p-4 rounded-xl shadow-md flex flex-col items-center gap-2 border-2 border-transparent"> <span class="text-3xl">ğŸ“¦</span> <span class="text-xs font-bold text-amber-900 text-center">Others</span> </button>
     </div>
    </div><!-- Ads Count -->
    <div class="flex items-center justify-between mb-4">
     <h2 id="ads-heading" class="text-amber-100 font-bold text-lg">All Advertisements</h2><span id="ads-count" class="bg-amber-800/50 text-amber-100 px-3 py-1 rounded-full text-sm">0 ads</span>
    </div><!-- Bulletin Board -->
    <div id="bulletin-board" class="bg-amber-800/30 backdrop-blur-sm rounded-2xl p-6 min-h-96 border-4 border-amber-900/50 shadow-inner">
     <div id="ads-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Ads will be rendered here -->
     </div>
     <div id="empty-state" class="hidden flex-col items-center justify-center py-16 text-center"><span class="text-6xl mb-4">ğŸ“‹</span>
      <h3 class="text-amber-100 font-bold text-xl mb-2">No ads yet!</h3>
      <p class="text-amber-200 mb-4">Be the first to post an advertisement</p><button id="empty-post-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-full font-bold transition-all"> Post Your First Ad </button>
     </div>
    </div><!-- Limit Warning -->
    <div id="limit-warning" class="hidden mt-4 bg-red-500/90 text-white px-4 py-3 rounded-lg text-center font-semibold">
     âš ï¸ Maximum limit of 999 ads reached. Please delete some ads to post new ones.
    </div>
   </main><!-- Post Ad Modal -->
   <div id="post-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-overlay absolute inset-0 bg-black/60" id="modal-backdrop"></div>
    <div class="relative bg-amber-50 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90%] overflow-auto">
     <div class="sticky top-0 bg-amber-900 text-white p-4 rounded-t-2xl flex items-center justify-between">
      <h3 class="font-bold text-lg">ğŸ“Œ Post New Advertisement</h3><button id="close-modal" class="w-8 h-8 rounded-full bg-amber-800 hover:bg-amber-700 flex items-center justify-center transition-all">âœ•</button>
     </div>
     <form id="ad-form" class="p-6 space-y-4">
      <div><label for="ad-category" class="block text-amber-900 font-bold mb-1 text-sm">Category *</label> <select id="ad-category" required class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none bg-white"> <option value="">Select category...</option> <option value="rentals">ğŸ¡ House &amp; Room Rentals</option> <option value="food">ğŸœ Food Stalls</option> <option value="jobs">ğŸ’¼ Jobs &amp; Services</option> <option value="transport">ğŸš— Transport</option> <option value="others">ğŸ“¦ Others</option> </select>
      </div>
      <div><label for="ad-title" class="block text-amber-900 font-bold mb-1 text-sm">Title *</label> <input type="text" id="ad-title" required maxlength="60" placeholder="e.g., Room for Rent Near Market" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
      </div>
      <div><label for="ad-description" class="block text-amber-900 font-bold mb-1 text-sm">Description *</label> <textarea id="ad-description" required rows="3" maxlength="300" placeholder="Describe your ad in detail..." class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none resize-none"></textarea>
      </div>
      <div class="grid grid-cols-2 gap-4">
       <div><label for="ad-price" class="block text-amber-900 font-bold mb-1 text-sm">Price</label> <input type="text" id="ad-price" placeholder="e.g., $500/month" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
       </div>
       <div><label for="ad-location" class="block text-amber-900 font-bold mb-1 text-sm">Location</label> <input type="text" id="ad-location" placeholder="e.g., Downtown" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
       </div>
      </div>
      <div class="border-t border-amber-200 pt-4">
       <p class="text-amber-700 font-bold text-sm mb-3">Contact Information</p>
       <div class="space-y-3">
        <div><label for="ad-name" class="block text-amber-900 font-bold mb-1 text-sm">Your Name *</label> <input type="text" id="ad-name" required placeholder="Full name" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
        </div>
        <div class="grid grid-cols-2 gap-4">
         <div><label for="ad-phone" class="block text-amber-900 font-bold mb-1 text-sm">Phone *</label> <input type="tel" id="ad-phone" required placeholder="Phone number" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
         </div>
         <div><label for="ad-email" class="block text-amber-900 font-bold mb-1 text-sm">Email</label> <input type="email" id="ad-email" placeholder="Email address" class="w-full px-4 py-2.5 rounded-lg border-2 border-amber-200 focus:border-emerald-500 focus:outline-none">
         </div>
        </div>
       </div>
      </div>
      <div class="flex gap-3 pt-2"><button type="button" id="cancel-btn" class="flex-1 px-4 py-3 rounded-lg border-2 border-amber-300 text-amber-700 font-bold hover:bg-amber-100 transition-all">Cancel</button> <button type="submit" id="submit-btn" class="flex-1 px-4 py-3 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white font-bold transition-all flex items-center justify-center gap-2"> <span id="submit-text">Post Ad</span> <span id="submit-loader" class="hidden">â³</span> </button>
      </div>
     </form>
    </div>
   </div><!-- View Ad Modal -->
   <div id="view-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-overlay absolute inset-0 bg-black/60" id="view-backdrop"></div>
    <div class="relative bg-amber-50 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90%] overflow-auto">
     <div id="view-header" class="sticky top-0 bg-amber-900 text-white p-4 rounded-t-2xl flex items-center justify-between">
      <div class="flex items-center gap-2"><span id="view-category-icon" class="text-2xl">ğŸ“Œ</span> <span id="view-category-name" class="font-semibold text-sm bg-amber-800 px-2 py-1 rounded">Category</span>
      </div><button id="close-view" class="w-8 h-8 rounded-full bg-amber-800 hover:bg-amber-700 flex items-center justify-center transition-all">âœ•</button>
     </div>
     <div class="p-6">
      <h3 id="view-title" class="text-xl font-extrabold text-amber-900 mb-3">Ad Title</h3>
      <p id="view-description" class="text-amber-700 mb-4 leading-relaxed">Description goes here...</p>
      <div class="grid grid-cols-2 gap-3 mb-4">
       <div id="view-price-box" class="bg-emerald-100 rounded-lg p-3">
        <p class="text-emerald-700 text-xs font-bold mb-1">ğŸ’° Price</p>
        <p id="view-price" class="text-emerald-900 font-bold">-</p>
       </div>
       <div id="view-location-box" class="bg-blue-100 rounded-lg p-3">
        <p class="text-blue-700 text-xs font-bold mb-1">ğŸ“ Location</p>
        <p id="view-location" class="text-blue-900 font-bold">-</p>
       </div>
      </div>
      <div class="bg-amber-100 rounded-lg p-4 mb-4">
       <p class="text-amber-700 text-xs font-bold mb-3">ğŸ“ Contact Information</p>
       <div class="space-y-2">
        <p class="flex items-center gap-2 text-amber-900"><span>ğŸ‘¤</span> <span id="view-contact-name" class="font-semibold">Name</span></p>
        <p class="flex items-center gap-2 text-amber-900"><span>ğŸ“±</span> <span id="view-contact-phone" class="font-semibold">Phone</span></p>
        <p id="view-email-row" class="flex items-center gap-2 text-amber-900"><span>âœ‰ï¸</span> <span id="view-contact-email" class="font-semibold">Email</span></p>
       </div>
      </div>
      <p id="view-date" class="text-amber-500 text-xs text-center mb-4">Posted on: -</p>
      <div class="flex gap-3"><button id="view-close-btn" class="flex-1 px-4 py-3 rounded-lg border-2 border-amber-300 text-amber-700 font-bold hover:bg-amber-100 transition-all">Close</button> <button id="view-delete-btn" class="px-4 py-3 rounded-lg bg-red-500 hover:bg-red-600 text-white font-bold transition-all">ğŸ—‘ï¸ Delete</button>
      </div><!-- Delete Confirmation -->
      <div id="delete-confirm" class="hidden mt-3 bg-red-100 rounded-lg p-4">
       <p class="text-red-800 font-bold text-sm mb-3">Are you sure you want to delete this ad?</p>
       <div class="flex gap-2"><button id="confirm-delete" class="flex-1 px-3 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white font-bold text-sm transition-all">Yes, Delete</button> <button id="cancel-delete" class="flex-1 px-3 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold text-sm transition-all">Cancel</button>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-full shadow-lg font-bold transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-50"><span id="toast-message">Success!</span>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      board_title: 'Community Bulletin Board',
      board_subtitle: 'Your local marketplace for ads & services',
      background_color: '#8B4513',
      header_color: '#78350f',
      card_color: '#fffbeb',
      text_color: '#78350f',
      accent_color: '#10b981',
      font_family: 'Nunito',
      font_size: 16
    };

    // State
    let allAds = [];
    let currentFilter = 'all';
    let currentViewingAd = null;

    // Category mapping
    const categoryInfo = {
      rentals: { icon: 'ğŸ¡', name: 'Rentals', colors: ['#ec4899', '#db2777', '#be185d', '#f472b6', '#fce7f3'] },
      food: { icon: 'ğŸœ', name: 'Food Stalls', colors: ['#f97316', '#ea580c', '#c2410c', '#fdba74', '#ffedd5'] },
      jobs: { icon: 'ğŸ’¼', name: 'Jobs & Services', colors: ['#3b82f6', '#2563eb', '#1d4ed8', '#93c5fd', '#dbeafe'] },
      transport: { icon: 'ğŸš—', name: 'Transport', colors: ['#8b5cf6', '#7c3aed', '#6d28d9', '#c4b5fd', '#ede9fe'] },
      others: { icon: 'ğŸ“¦', name: 'Others', colors: ['#64748b', '#475569', '#334155', '#94a3b8', '#e2e8f0'] }
    };

    // Pin colors for variety
    const pinColors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6', '#ec4899'];

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('board-title').textContent = config.board_title || defaultConfig.board_title;
          document.getElementById('board-subtitle').textContent = config.board_subtitle || defaultConfig.board_subtitle;
          
          const fontFamily = config.font_family || defaultConfig.font_family;
          document.body.style.fontFamily = `${fontFamily}, sans-serif`;
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (v) => { config.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => config.header_color || defaultConfig.header_color,
              set: (v) => { config.header_color = v; window.elementSdk.setConfig({ header_color: v }); }
            },
            {
              get: () => config.card_color || defaultConfig.card_color,
              set: (v) => { config.card_color = v; window.elementSdk.setConfig({ card_color: v }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (v) => { config.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (v) => { config.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (v) => { config.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['board_title', config.board_title || defaultConfig.board_title],
          ['board_subtitle', config.board_subtitle || defaultConfig.board_subtitle]
        ])
      });
    }

    // Initialize Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allAds = data;
        renderAds();
        updateAdsCount();
        checkLimit();
      }
    };

    async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
    }
    initDataSdk();

    // Render ads based on current filter
    function renderAds() {
      const container = document.getElementById('ads-container');
      const emptyState = document.getElementById('empty-state');
      
      const filteredAds = currentFilter === 'all' 
        ? allAds 
        : allAds.filter(ad => ad.category === currentFilter);

      if (filteredAds.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        emptyState.classList.add('flex');
        return;
      }

      emptyState.classList.add('hidden');
      emptyState.classList.remove('flex');

      // Create a map of existing cards
      const existingCards = new Map();
      container.querySelectorAll('.ad-card').forEach(card => {
        existingCards.set(card.dataset.adId, card);
      });

      // Sort by date (newest first)
      const sortedAds = [...filteredAds].sort((a, b) => 
        new Date(b.created_at) - new Date(a.created_at)
      );

      // Update or create cards
      sortedAds.forEach((ad, index) => {
        const cat = categoryInfo[ad.category] || categoryInfo.others;
        const pinColor = pinColors[index % pinColors.length];
        
        if (existingCards.has(ad.__backendId)) {
          // Update existing card
          const card = existingCards.get(ad.__backendId);
          card.querySelector('.ad-title').textContent = ad.title;
          card.querySelector('.ad-description').textContent = ad.description.length > 80 
            ? ad.description.substring(0, 80) + '...' 
            : ad.description;
          card.querySelector('.ad-price').textContent = ad.price || 'Contact for price';
          card.querySelector('.ad-location').textContent = ad.location || 'Not specified';
          existingCards.delete(ad.__backendId);
        } else {
          // Create new card
          const card = document.createElement('div');
          card.className = 'ad-card relative bg-amber-50 rounded-xl shadow-lg overflow-hidden cursor-pointer';
          card.dataset.adId = ad.__backendId;
          card.innerHTML = `
            <div class="pin" style="background: ${pinColor};"></div>
            <div class="p-4 pt-5">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-xl">${cat.icon}</span>
                <span class="text-xs font-bold px-2 py-1 rounded-full" style="background: ${cat.colors[4]}; color: ${cat.colors[2]};">${cat.name}</span>
              </div>
              <h3 class="ad-title font-bold text-amber-900 mb-2 line-clamp-2">${ad.title}</h3>
              <p class="ad-description text-amber-700 text-sm mb-3 line-clamp-2">${ad.description.length > 80 ? ad.description.substring(0, 80) + '...' : ad.description}</p>
              <div class="flex items-center justify-between text-xs">
                <span class="ad-price font-bold text-emerald-600">ğŸ’° ${ad.price || 'Contact for price'}</span>
                <span class="ad-location text-amber-500">ğŸ“ ${ad.location || 'Not specified'}</span>
              </div>
            </div>
          `;
          card.addEventListener('click', () => openViewModal(ad));
          container.appendChild(card);
        }
      });

      // Remove cards that no longer exist
      existingCards.forEach(card => card.remove());
    }

    // Update ads count
    function updateAdsCount() {
      const filteredCount = currentFilter === 'all' 
        ? allAds.length 
        : allAds.filter(ad => ad.category === currentFilter).length;
      
      document.getElementById('ads-count').textContent = `${filteredCount} ad${filteredCount !== 1 ? 's' : ''}`;
      
      const headingText = currentFilter === 'all' 
        ? 'All Advertisements' 
        : `${categoryInfo[currentFilter]?.name || 'Other'} Ads`;
      document.getElementById('ads-heading').textContent = headingText;
    }

    // Check limit
    function checkLimit() {
      const limitWarning = document.getElementById('limit-warning');
      if (allAds.length >= 999) {
        limitWarning.classList.remove('hidden');
      } else {
        limitWarning.classList.add('hidden');
      }
    }

    // Category filter buttons
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentFilter = btn.dataset.category;
        
        // Update active state
        document.querySelectorAll('.category-btn').forEach(b => {
          b.classList.remove('border-emerald-500', 'bg-emerald-100');
          b.classList.add('border-transparent');
        });
        btn.classList.add('border-emerald-500', 'bg-emerald-100');
        btn.classList.remove('border-transparent');
        
        renderAds();
        updateAdsCount();
      });
    });

    // Set initial active category
    document.querySelector('[data-category="all"]').classList.add('border-emerald-500', 'bg-emerald-100');

    // Modal controls
    const postModal = document.getElementById('post-modal');
    const viewModal = document.getElementById('view-modal');

    function openPostModal() {
      if (allAds.length >= 999) {
        showToast('Maximum limit reached. Delete some ads first.');
        return;
      }
      postModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closePostModal() {
      postModal.classList.add('hidden');
      document.body.style.overflow = '';
      document.getElementById('ad-form').reset();
    }

    function openViewModal(ad) {
      currentViewingAd = ad;
      const cat = categoryInfo[ad.category] || categoryInfo.others;
      
      document.getElementById('view-category-icon').textContent = cat.icon;
      document.getElementById('view-category-name').textContent = cat.name;
      document.getElementById('view-title').textContent = ad.title;
      document.getElementById('view-description').textContent = ad.description;
      document.getElementById('view-price').textContent = ad.price || 'Contact for price';
      document.getElementById('view-location').textContent = ad.location || 'Not specified';
      document.getElementById('view-contact-name').textContent = ad.contact_name;
      document.getElementById('view-contact-phone').textContent = ad.contact_phone;
      
      const emailRow = document.getElementById('view-email-row');
      if (ad.contact_email) {
        emailRow.classList.remove('hidden');
        document.getElementById('view-contact-email').textContent = ad.contact_email;
      } else {
        emailRow.classList.add('hidden');
      }
      
      const date = new Date(ad.created_at);
      document.getElementById('view-date').textContent = `Posted on: ${date.toLocaleDateString('en-US', { 
        year: 'numeric', month: 'long', day: 'numeric' 
      })}`;
      
      document.getElementById('delete-confirm').classList.add('hidden');
      viewModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeViewModal() {
      viewModal.classList.add('hidden');
      document.body.style.overflow = '';
      currentViewingAd = null;
    }

    // Event listeners for modals
    document.getElementById('post-ad-btn').addEventListener('click', openPostModal);
    document.getElementById('empty-post-btn').addEventListener('click', openPostModal);
    document.getElementById('close-modal').addEventListener('click', closePostModal);
    document.getElementById('cancel-btn').addEventListener('click', closePostModal);
    document.getElementById('modal-backdrop').addEventListener('click', closePostModal);

    document.getElementById('close-view').addEventListener('click', closeViewModal);
    document.getElementById('view-close-btn').addEventListener('click', closeViewModal);
    document.getElementById('view-backdrop').addEventListener('click', closeViewModal);

    // Delete functionality
    document.getElementById('view-delete-btn').addEventListener('click', () => {
      document.getElementById('delete-confirm').classList.remove('hidden');
    });

    document.getElementById('cancel-delete').addEventListener('click', () => {
      document.getElementById('delete-confirm').classList.add('hidden');
    });

    document.getElementById('confirm-delete').addEventListener('click', async () => {
      if (!currentViewingAd || !window.dataSdk) return;
      
      const btn = document.getElementById('confirm-delete');
      btn.disabled = true;
      btn.textContent = 'Deleting...';
      
      const result = await window.dataSdk.delete(currentViewingAd);
      
      btn.disabled = false;
      btn.textContent = 'Yes, Delete';
      
      if (result.isOk) {
        closeViewModal();
        showToast('Ad deleted successfully!');
      } else {
        showToast('Failed to delete ad. Please try again.');
      }
    });

    // Form submission
    document.getElementById('ad-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!window.dataSdk) return;
      
      if (allAds.length >= 999) {
        showToast('Maximum limit reached. Delete some ads first.');
        return;
      }
      
      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      const submitLoader = document.getElementById('submit-loader');
      
      submitBtn.disabled = true;
      submitText.textContent = 'Posting...';
      submitLoader.classList.remove('hidden');
      
      const newAd = {
        id: Date.now().toString(),
        category: document.getElementById('ad-category').value,
        title: document.getElementById('ad-title').value,
        description: document.getElementById('ad-description').value,
        price: document.getElementById('ad-price').value,
        location: document.getElementById('ad-location').value,
        contact_name: document.getElementById('ad-name').value,
        contact_phone: document.getElementById('ad-phone').value,
        contact_email: document.getElementById('ad-email').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(newAd);
      
      submitBtn.disabled = false;
      submitText.textContent = 'Post Ad';
      submitLoader.classList.add('hidden');
      
      if (result.isOk) {
        closePostModal();
        showToast('Your ad has been posted! ğŸ‰');
      } else {
        showToast('Failed to post ad. Please try again.');
      }
    });

    // Toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      toast.classList.remove('opacity-0', 'translate-y-4');
      toast.classList.add('opacity-100', 'translate-y-0');
      
      setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-4');
        toast.classList.remove('opacity-100', 'translate-y-0');
      }, 3000);
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d1c912d34d3fc5d',t:'MTc3MTc0MzIxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>